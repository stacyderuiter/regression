<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GLMs and Friends - 1&nbsp; Linear Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./lm-assess.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./lm1.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Linear Regression</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GLMs and Friends</a> 
        <div class="sidebar-tools-main">
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./GLMs-and-Friends.pdf">
              <i class="bi bi-bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./GLMs-and-Friends.epub">
              <i class="bi bi-bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lm1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Linear Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lm-assess.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Model Diagnostics and Assessment</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./IC-based-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Model Selection Using Information Criteria</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./likelihood.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Likelihood</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pdf-pmf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">PDFs and PMFs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./count-data-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Regression for Count Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-averaging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Model Averaging</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interactions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Interactions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./binary-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Binary Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./binary-regression2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Binary regression: Data with more than one trial per row</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./collinearity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Collinearity and Multicollinearity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./zero-inflation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Zero-Inflation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ncv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Non-constant variance (and other unresolved problems)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./random-effects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Random Effects</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./random-effects2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Random effects with glmmTMB and standardized residuals</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gee-motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">GEEs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./corr-struct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Correlation Structures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./anova-plus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Other Model Selection Approaches</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">GAMs: Generalized Additive Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data"><span class="header-section-number">1.1</span> Data</a></li>
  <li><a href="#preliminary-considerations" id="toc-preliminary-considerations" class="nav-link" data-scroll-target="#preliminary-considerations"><span class="header-section-number">1.2</span> Preliminary Considerations</a></li>
  <li><a href="#response-and-predictors" id="toc-response-and-predictors" class="nav-link" data-scroll-target="#response-and-predictors"><span class="header-section-number">1.3</span> Response and Predictors</a>
  <ul class="collapse">
  <li><a href="#sample-size-and-predictors" id="toc-sample-size-and-predictors" class="nav-link" data-scroll-target="#sample-size-and-predictors"><span class="header-section-number">1.3.1</span> Sample size and predictors</a></li>
  </ul></li>
  <li><a href="#simple-linear-regression-residuals-least-squares" id="toc-simple-linear-regression-residuals-least-squares" class="nav-link" data-scroll-target="#simple-linear-regression-residuals-least-squares"><span class="header-section-number">1.4</span> Simple linear regression, Residuals &amp; Least squares</a>
  <ul class="collapse">
  <li><a href="#using-lm-to-fit-a-linear-regression-in-r" id="toc-using-lm-to-fit-a-linear-regression-in-r" class="nav-link" data-scroll-target="#using-lm-to-fit-a-linear-regression-in-r"><span class="header-section-number">1.4.1</span> Using <code>lm()</code> to fit a linear regression in R</a></li>
  <li><a href="#equation-of-the-fitted-regression-line" id="toc-equation-of-the-fitted-regression-line" class="nav-link" data-scroll-target="#equation-of-the-fitted-regression-line"><span class="header-section-number">1.4.2</span> Equation of the fitted regression line</a></li>
  <li><a href="#regression-residuals-errors" id="toc-regression-residuals-errors" class="nav-link" data-scroll-target="#regression-residuals-errors"><span class="header-section-number">1.4.3</span> Regression residuals = “errors”</a></li>
  </ul></li>
  <li><a href="#multiple-regression" id="toc-multiple-regression" class="nav-link" data-scroll-target="#multiple-regression"><span class="header-section-number">1.5</span> Multiple regression</a>
  <ul class="collapse">
  <li><a href="#choosing-predictors" id="toc-choosing-predictors" class="nav-link" data-scroll-target="#choosing-predictors"><span class="header-section-number">1.5.1</span> Choosing predictors</a></li>
  <li><a href="#estimation" id="toc-estimation" class="nav-link" data-scroll-target="#estimation"><span class="header-section-number">1.5.2</span> Estimation</a></li>
  <li><a href="#computing-predictions" id="toc-computing-predictions" class="nav-link" data-scroll-target="#computing-predictions"><span class="header-section-number">1.5.3</span> Computing Predictions</a></li>
  </ul></li>
  <li><a href="#predictors-with-two-categories" id="toc-predictors-with-two-categories" class="nav-link" data-scroll-target="#predictors-with-two-categories"><span class="header-section-number">1.6</span> Predictors with two categories</a>
  <ul class="collapse">
  <li><a href="#predictors-with-more-categories" id="toc-predictors-with-more-categories" class="nav-link" data-scroll-target="#predictors-with-more-categories"><span class="header-section-number">1.6.1</span> Predictors with more categories</a></li>
  </ul></li>
  <li><a href="#returning-to-the-r-model-summary" id="toc-returning-to-the-r-model-summary" class="nav-link" data-scroll-target="#returning-to-the-r-model-summary"><span class="header-section-number">1.7</span> Returning to the R Model Summary</a></li>
  <li><a href="#predictions-from-the-model" id="toc-predictions-from-the-model" class="nav-link" data-scroll-target="#predictions-from-the-model"><span class="header-section-number">1.8</span> Predictions from the model</a>
  <ul class="collapse">
  <li><a href="#by-hand" id="toc-by-hand" class="nav-link" data-scroll-target="#by-hand"><span class="header-section-number">1.8.1</span> By Hand</a></li>
  <li><a href="#prediction-plots-in-r" id="toc-prediction-plots-in-r" class="nav-link" data-scroll-target="#prediction-plots-in-r"><span class="header-section-number">1.8.2</span> Prediction Plots in R</a></li>
  </ul></li>
  <li><a href="#why-are-we-doing-this-again" id="toc-why-are-we-doing-this-again" class="nav-link" data-scroll-target="#why-are-we-doing-this-again"><span class="header-section-number">1.9</span> Why are we doing this again?</a></li>
  <li><a href="#shortcut-method---with-uncertainty" id="toc-shortcut-method---with-uncertainty" class="nav-link" data-scroll-target="#shortcut-method---with-uncertainty"><span class="header-section-number">1.10</span> Shortcut Method - With Uncertainty</a>
  <ul class="collapse">
  <li><a href="#anatomy-of-a-confidence-interval" id="toc-anatomy-of-a-confidence-interval" class="nav-link" data-scroll-target="#anatomy-of-a-confidence-interval"><span class="header-section-number">1.10.1</span> Anatomy of a Confidence Interval</a></li>
  </ul></li>
  <li><a href="#diy-method" id="toc-diy-method" class="nav-link" data-scroll-target="#diy-method"><span class="header-section-number">1.11</span> DIY Method</a>
  <ul class="collapse">
  <li><a href="#creating-a-hypothetical-dataset" id="toc-creating-a-hypothetical-dataset" class="nav-link" data-scroll-target="#creating-a-hypothetical-dataset"><span class="header-section-number">1.11.1</span> Creating a hypothetical dataset</a></li>
  <li><a href="#making-the-plot" id="toc-making-the-plot" class="nav-link" data-scroll-target="#making-the-plot"><span class="header-section-number">1.11.2</span> Making the plot</a></li>
  <li><a href="#categorical-predictors" id="toc-categorical-predictors" class="nav-link" data-scroll-target="#categorical-predictors"><span class="header-section-number">1.11.3</span> Categorical predictors</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Linear Regression</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>You probably learned something about linear regression in a previous course. Here, we briefly review the main concepts of simple linear regression and quickly expand our tool box to multiple regression (with both quantitative and categorical predictors).</p>
<section id="data" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="data"><span class="header-section-number">1.1</span> Data</h2>
<p>We will consider a small dataset from an article by J.S. Martin and colleagues, titled <a href="https://royalsocietypublishing.org/doi/suppl/10.1098/rsbl.2019.0232"><em>Facial width-to-height ratio is associated with agonistic and affiliative dominance in bonobos (<strong>Pan paniscus</strong>)</em></a></p>
<p>Notes: variable <code>fWHR</code> is the facial width-height ratio and <code>AssR</code> is the Assertiveness score of affiliative dominance. <code>normDS</code> is another dominance score.</p>
<p>What figures should we consider, to get a sense of the dataset and think about how we might model <code>fWHR</code>?</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 117
Columns: 8
$ Name   &lt;chr&gt; "Zuani", "Zuani", "Zorba", "Zorba", "Zorba", "Zomi", "Zomi", "Z…
$ Group  &lt;chr&gt; "Apenheul", "Apenheul", "Wilhelma", "Wilhelma", "Wilhelma", "Fr…
$ Sex    &lt;chr&gt; "Female", "Female", "Male", "Male", "Male", "Female", "Female",…
$ Age    &lt;dbl&gt; 22, 22, 34, 34, 34, 15, 15, 14, 14, 14, 18, 18, 18, 18, 18, 12,…
$ fWHR   &lt;dbl&gt; 1.475052, 1.321814, 1.581446, 1.479237, 1.390086, 1.340909, 1.2…
$ AssR   &lt;dbl&gt; 5.36, 5.36, 2.36, 2.36, 2.36, 3.92, 3.92, 4.74, 4.74, 4.74, 2.6…
$ normDS &lt;dbl&gt; 1.430, 1.430, 2.341, 2.341, 2.341, 3.087, 3.087, 3.035, 3.035, …
$ weight &lt;dbl&gt; 24.0, 24.0, NA, NA, NA, NA, NA, 41.6, 41.6, 41.6, 38.0, 38.0, 3…</code></pre>
</div>
</div>
</section>
<section id="preliminary-considerations" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="preliminary-considerations"><span class="header-section-number">1.2</span> Preliminary Considerations</h2>
<p>Just as we imagine before we start coding to create graphics, we ought to think before we start fitting models.</p>
<p>Traditional ways of interpreting statistical results are premised on the idea that you made a plan, got some data, fitted the model you planned, and want to draw conclusions.</p>
<p>If, instead, you got data, scrutinized the data, fitted lots of different models, and now want to report results from the one that fitted best…well, generally things tend to go wrong. This is especially true if you use the data to lead you from a more complex to a simpler model. As Harrell (2015) points out in section 4.3,</p>
<ul>
<li>Uncertainty <em>underestimated</em> (overconfidence: standard errors and confidence intervals too small; <span class="math inline">\(R^2\)</span> too big)</li>
<li>Spurious relationships look important and slope estimates are biased high</li>
<li>If testing hypotheses, p-values <em>too small</em></li>
</ul>
<p>How can we avoid these problems? Some more insight will come when we consider model assessment and selection in future sections. For now, we need to remember:</p>
<blockquote class="blockquote">
<p>Fitting and interpreting <strong>one</strong> well-considered, sensible model is prefereable to trying many things and then trying to choose among them later.</p>
</blockquote>
</section>
<section id="response-and-predictors" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="response-and-predictors"><span class="header-section-number">1.3</span> Response and Predictors</h2>
<p>A regression model is our attempt to quantify how a <strong>response variable</strong> of interest changes when a set of <strong>predictor variables</strong> change.</p>
<p>So, to begin, we need to identify our (one) response variable – the thing we are most interested in measuring or predicting or describing or understanding.</p>
<p>Then, we need to identify a set of predictor variables that we expect to be associated with changes in the response. (If we are planning an experiment, they should be variables we can collect data on; if working with data already collected, they must be in or derived from the data available.)</p>
<p>How do we choose which predictors to include, and how many?</p>
<p>First, rely on experts and previous experience. If you know the context of the problem well, <em>you</em> have a good sense of the predictors that will be of interest. If you don’t, then you should consult experts (or published work on the topic).</p>
<p>There are also practical limits on the number of predictors you can reasonably consider, given a dataset.</p>
<section id="sample-size-and-predictors" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="sample-size-and-predictors"><span class="header-section-number">1.3.1</span> Sample size and predictors</h3>
<p>One important consideration, when planning a regression model, is: <em>How many predictors can I reasonably include?</em></p>
<p>It depends on the size of the dataset: it takes several observations to get a good estimate of any statistics, so it makes sense that fitting a model with <em>lots</em> of predictors will require a bigger dataset. And if you try to fit too many, the chances of <em>overfitting</em> increase. <em>Overfitting</em> is when you model noise as well as signal, capturing in your model apparent relationships that actually exist only in the current dataset, not in reality.</p>
<p>For linear regression, Harrell (2015, Chapter 4.6) offers a rule of thumb: the number of parameters being estimated, <span class="math inline">\(p\)</span>, should be less than <span class="math inline">\(\frac{n}{10}\)</span> or <span class="math inline">\(\frac{n}{20}\)</span>. To give just one standard rule of thumb, we should aim for <span class="math inline">\(p &lt; \frac{n}{15}\)</span>. <span class="math inline">\(n\)</span> is the sample size (number of rows in the dataset).</p>
</section>
</section>
<section id="simple-linear-regression-residuals-least-squares" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="simple-linear-regression-residuals-least-squares"><span class="header-section-number">1.4</span> Simple linear regression, Residuals &amp; Least squares</h2>
<p>First, let’s review and consider a simple (one-predictor) linear regression model. Fit the model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>slr <span class="ot">&lt;-</span> <span class="fu">lm</span>(fWHR <span class="sc">~</span> AssR, <span class="at">data=</span>bonobos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Extract the slope and intercept values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(slr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)        AssR 
 1.30685287  0.02918242 </code></pre>
</div>
</div>
<p>Add the regression line to the plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_point</span>(fWHR <span class="sc">~</span> AssR, <span class="at">data=</span>bonobos) <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_lm</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lm1_files/figure-html/lm-scatter-with-line-1.png" class="img-fluid" width="624"></p>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(slr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = fWHR ~ AssR, data = bonobos)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.31320 -0.11369 -0.01242  0.09008  0.49241 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1.30685    0.06283  20.801   &lt;2e-16 ***
AssR         0.02918    0.01420   2.055   0.0421 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1689 on 115 degrees of freedom
Multiple R-squared:  0.03542,   Adjusted R-squared:  0.02704 
F-statistic: 4.223 on 1 and 115 DF,  p-value: 0.04213</code></pre>
</div>
</div>
<section id="using-lm-to-fit-a-linear-regression-in-r" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="using-lm-to-fit-a-linear-regression-in-r"><span class="header-section-number">1.4.1</span> Using <code>lm()</code> to fit a linear regression in R</h3>
<p>We use function <code>lm()</code> with a formula of the form <code>y ~ x</code> (and an input <code>data = _____</code>).</p>
<p>To view the result, we ask for a <code>summary()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>slr <span class="ot">&lt;-</span> <span class="fu">lm</span>(fWHR <span class="sc">~</span> AssR, <span class="at">data =</span> bonobos)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(slr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = fWHR ~ AssR, data = bonobos)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.31320 -0.11369 -0.01242  0.09008  0.49241 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1.30685    0.06283  20.801   &lt;2e-16 ***
AssR         0.02918    0.01420   2.055   0.0421 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1689 on 115 degrees of freedom
Multiple R-squared:  0.03542,   Adjusted R-squared:  0.02704 
F-statistic: 4.223 on 1 and 115 DF,  p-value: 0.04213</code></pre>
</div>
</div>
<p>From this traditional on-screen output, we can fetch the information and estimates we need.</p>
<p>We can also “clean up” the output into a data table using <code>broom::tidy()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(slr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)   1.31      0.0628     20.8  8.83e-41
2 AssR          0.0292    0.0142      2.06 4.21e- 2</code></pre>
</div>
</div>
</section>
<section id="equation-of-the-fitted-regression-line" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="equation-of-the-fitted-regression-line"><span class="header-section-number">1.4.2</span> Equation of the fitted regression line</h3>
<p>In the process above, we chose a <em>response</em> variable <span class="math inline">\(y\)</span>, a <em>predictor</em> <span class="math inline">\(x\)</span>, and estimated the slope and intercept of the line <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>.</p>
<p><span class="math display">\[ y = \beta_0 + \beta_1 x\]</span></p>
<p>But the data don’t lie perfectly on the line, and we have too include that in our model, too. There is some error <span class="math inline">\(\epsilon\)</span> in our model for the data, so we should keep track of it.</p>
<p><span class="math display">\[ y = \beta_0 + \beta_1 x + \epsilon\]</span></p>
<p>But <span class="math inline">\(\epsilon\)</span> is not <em>one number</em> to be estimated – the amount of error is different for every data point! How can we express this mathematically?</p>
</section>
<section id="regression-residuals-errors" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="regression-residuals-errors"><span class="header-section-number">1.4.3</span> Regression residuals = “errors”</h3>
<p>First, we need a way to measure how far the model line is from the data, for every observation in the dataset. The <em>residual</em> for the <em>i</em>th observation is the observed response variable value from the data (<span class="math inline">\(y_i\)</span>) minus the <em>predicted response value</em> on the regression line (<span class="math inline">\(\hat{y}_i\)</span>). This will be the response variable value for the point on the line whose predictor (<span class="math inline">\(x\)</span> value is the same as for the observed data point). These “residuals” are shown in red on the figure. (The numeric value of each residual is the length of its red line segment.)</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="lm1_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>How can we summarize this information? Let’s look at the distribution of the residuals:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_histogram</span>(<span class="sc">~</span><span class="fu">resid</span>(slr), <span class="at">bins =</span> <span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lm1_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Hmmm…looks pretty unimodal, and symmetric (except for a bit of right skew). It almost has that familiar bell shape…like a Normal distribution. This is a hint.</p>
<p>In linear regression, we model residuals with a normal distribution, with mean zero (the line should go through the “middle” of the points, and averaging over them all, our residual should be 0).</p>
<p>The standard deviation of the residuals depends on how far away the points are, on average, from the line. This value, the residual standard deviation <span class="math inline">\(\sigma\)</span>, must be estimated in each case.</p>
<p>R <code>lm()</code> summary output calls it “residual standard error” and lists it near the bottom of the summary. (This is a somewhat inaccurate name but we’re stuck with it.)</p>
<p>So now we can give a <em>complete</em> model equation. In general,</p>
<p><span class="math display">\[ y = \beta_0 + \beta_1 x + \epsilon,\]</span> where</p>
<p><span class="math display">\[ \epsilon \sim N(0, \sigma)\]</span></p>
<p>Or, in our specific case with the Bonobos,</p>
<p><span class="math display">\[ y = 1.31 + 0.029 x + \epsilon, \text{ where } \epsilon \sim N(0, 0.169)\]</span></p>
</section>
</section>
<section id="multiple-regression" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="multiple-regression"><span class="header-section-number">1.5</span> Multiple regression</h2>
<p>Rarely does our response variable <strong>really</strong> depend on only one predictor. Can we expand our formulation to include more predictors? In R, it’s super easy:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>mlr <span class="ot">&lt;-</span> <span class="fu">lm</span>(fWHR <span class="sc">~</span> AssR <span class="sc">+</span> weight, <span class="at">data=</span>bonobos)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mlr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)        AssR      weight 
0.944790930 0.039888045 0.008644299 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="lm1_files/figure-html/mult-reg-plots-1.png" class="img-fluid" width="312"></p>
</div>
<div class="cell-output-display">
<p><img src="lm1_files/figure-html/mult-reg-plots-2.png" class="img-fluid" width="312"></p>
</div>
</div>
<section id="choosing-predictors" class="level3" data-number="1.5.1">
<h3 data-number="1.5.1" class="anchored" data-anchor-id="choosing-predictors"><span class="header-section-number">1.5.1</span> Choosing predictors</h3>
<p>Notice that in this chapter, we are building up from a simpler model to a more complex one with more predictors. This is to reveal to you the mathematical machinery that lets us specify and fit the more complex models.</p>
<p><strong>But this is</strong> <em>not</em> <strong>how to build a model in practice</strong>. Recall, we agreed to think carefully and choose a reasonable set of predictors to use at the outset, doing as much of the work as possible before even looking at the dataset. Our <span class="math inline">\(p &lt; \frac{n}{15}\)</span> rule gives a rough limit to the maximum number of parameters we can estimate. If we do otherwise, we have to be cautious and know all our conclusions are on much shakier ground.</p>
</section>
<section id="estimation" class="level3" data-number="1.5.2">
<h3 data-number="1.5.2" class="anchored" data-anchor-id="estimation"><span class="header-section-number">1.5.2</span> Estimation</h3>
<p>But…how did R come up with those estimates of the slope and intercept (and residual standard deviation) parameters?</p>
<p>In the simple linear regression case, it’s easy to visualize:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="lm1_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The <em>best</em> line is the one that makes the residuals the smallest (by going right through the middle of the points). OK, let’s be careful: some residuals are positive and some are negative, and we want the line that minimizes their magnitude. The traditional approach is to choose the slope that minimizes the sum of the squared residuals,</p>
<p><span class="math display">\[ SSE = \sum_{i=1}^{n} (y_i - \hat{y}_i)^2\]</span></p>
<p>How does this work when we have <em>multiple</em> predictors? It’s harder to draw, but just as easy to compute <span class="math inline">\(\hat{y}\)</span> and thus the observed residuals <span class="math inline">\(e_i\)</span>.</p>
</section>
<section id="computing-predictions" class="level3" data-number="1.5.3">
<h3 data-number="1.5.3" class="anchored" data-anchor-id="computing-predictions"><span class="header-section-number">1.5.3</span> Computing Predictions</h3>
<p>Use the regression equation to compute <strong>predicted values</strong> for the three data points below:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
   fWHR  AssR weight
  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1  1.88  4.74   41.6
2  1.80  5.38   50.6
3  1.59  3.97   NA  
4  1.55  4.87   38.5</code></pre>
</div>
</div>
<p><br> <br> <br> <br></p>
</section>
</section>
<section id="predictors-with-two-categories" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="predictors-with-two-categories"><span class="header-section-number">1.6</span> Predictors with two categories</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="lm1_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="624"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mlr2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fWHR <span class="sc">~</span> AssR <span class="sc">+</span> weight <span class="sc">+</span> Sex, <span class="at">data =</span> bonobos)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mlr2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)        AssR      weight     SexMale 
1.065420976 0.058435841 0.002257142 0.128484275 </code></pre>
</div>
</div>
<p>How does the model incorporate this covariate mathematically?</p>
<p><br> <br> <br> <br></p>
<section id="predictors-with-more-categories" class="level3" data-number="1.6.1">
<h3 data-number="1.6.1" class="anchored" data-anchor-id="predictors-with-more-categories"><span class="header-section-number">1.6.1</span> Predictors with more categories</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_boxplot</span>(fWHR <span class="sc">~</span> Group, <span class="at">data =</span> bonobos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lm1_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="624"></p>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>mlr3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fWHR <span class="sc">~</span> AssR <span class="sc">+</span> weight <span class="sc">+</span> Sex <span class="sc">+</span> Group, <span class="at">data =</span> bonobos)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mlr3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      (Intercept)              AssR            weight           SexMale 
      1.007734691       0.064361973       0.003458979       0.124854271 
   GroupFrankfurt GroupPlanckendael     GroupTwycross     GroupWilhelma 
      0.037426358      -0.008464572      -0.112907589       0.011186724 
   GroupWuppertal 
     -0.004364826 </code></pre>
</div>
</div>
<p>How does the model incorporate <strong>this</strong> covariate mathematically?</p>
<p><br> <br> <br></p>
</section>
</section>
<section id="returning-to-the-r-model-summary" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="returning-to-the-r-model-summary"><span class="header-section-number">1.7</span> Returning to the R Model Summary</h2>
<p>There are several bits of information you should be able to extract from the <code>summary()</code> output R produces on a fitted linear regression model:</p>
<ul>
<li><p><span class="math inline">\(\beta\)</span>s, Coefficient Estimates</p></li>
<li><p><span class="math inline">\(\sigma\)</span>, labeled “residual standard error” <br> <br> <br> <br></p></li>
<li><p><span class="math inline">\(R^2\)</span> (adjusted)</p></li>
</ul>
<p><br> <br> <br> <br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>mlr3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fWHR <span class="sc">~</span> AssR <span class="sc">+</span> weight <span class="sc">+</span> Sex <span class="sc">+</span> Group, <span class="at">data =</span> bonobos)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlr3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = fWHR ~ AssR + weight + Sex + Group, data = bonobos)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.38288 -0.09488 -0.02642  0.07196  0.48464 

Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)        1.007735   0.217585   4.631 2.05e-05 ***
AssR               0.064362   0.021158   3.042   0.0035 ** 
weight             0.003459   0.005547   0.624   0.5353    
SexMale            0.124854   0.059278   2.106   0.0394 *  
GroupFrankfurt     0.037426   0.074892   0.500   0.6191    
GroupPlanckendael -0.008465   0.075407  -0.112   0.9110    
GroupTwycross     -0.112908   0.074779  -1.510   0.1364    
GroupWilhelma      0.011187   0.085538   0.131   0.8964    
GroupWuppertal    -0.004365   0.071292  -0.061   0.9514    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1691 on 59 degrees of freedom
  (49 observations deleted due to missingness)
Multiple R-squared:  0.2517,    Adjusted R-squared:  0.1502 
F-statistic:  2.48 on 8 and 59 DF,  p-value: 0.02167</code></pre>
</div>
</div>
</section>
<section id="predictions-from-the-model" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="predictions-from-the-model"><span class="header-section-number">1.8</span> Predictions from the model</h2>
<section id="by-hand" class="level3" data-number="1.8.1">
<h3 data-number="1.8.1" class="anchored" data-anchor-id="by-hand"><span class="header-section-number">1.8.1</span> By Hand</h3>
<p>The equation for the fitted model above is:</p>
<p><span class="math display">\[ y = \beta_0 + \beta_1x_1 + \beta_2x_2 + \beta_3I_{Male} + \beta_4I_{Frankfurt} + \beta_5I_{Planckendael} + \beta_6I_{Twycross} + \beta_7I_{Wilhelma} + \beta_7I_{Wuppertal} + \epsilon\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(y =\)</span></li>
<li><span class="math inline">\(\beta_0=\)</span></li>
</ul>
<p><br> <br> <br> <br></p>
<ul>
<li><span class="math inline">\(x_1=\)</span></li>
<li><span class="math inline">\(x_2=\)</span></li>
<li><span class="math inline">\(\beta_1, \beta_2, \beta_3 ...\)</span> are:</li>
<li><span class="math inline">\(I_{Male} =\)</span></li>
<li><span class="math inline">\(I_{Frankfurt} =\)</span></li>
<li><span class="math inline">\(I_{Planckendael} =\)</span> , etc.</li>
<li><span class="math inline">\(\epsilon=\)</span></li>
</ul>
<section id="comprehension-check" class="level4" data-number="1.8.1.1">
<h4 data-number="1.8.1.1" class="anchored" data-anchor-id="comprehension-check"><span class="header-section-number">1.8.1.1</span> Comprehension check:</h4>
<p>What is the expected fWHR (according to this model) for a 30 kg female bonobo at the Wilhelma zoo?</p>
<p><br> <br> <br> <br></p>
</section>
</section>
<section id="prediction-plots-in-r" class="level3" data-number="1.8.2">
<h3 data-number="1.8.2" class="anchored" data-anchor-id="prediction-plots-in-r"><span class="header-section-number">1.8.2</span> Prediction Plots in R</h3>
<p>We can ask R to compute predictions for <strong>all</strong> the data points in the real dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>bonobos <span class="ot">&lt;-</span> bonobos <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">preds =</span> <span class="fu">predict</span>(mlr3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `mutate()`:
ℹ In argument: `preds = predict(mlr3)`.
Caused by error:
! `preds` must be size 117 or 1, not 68.</code></pre>
</div>
</div>
<p>Wait, what? This error is because the <code>lm()</code> function removes rows containing missing values from the dataset, so it computes only 68 residuals (for the complete cases in the data). This doesn’t match the 117 rows in the original data. We can solve the problem by omitting rows with missing values first. To be safe, we first select only the variables we need, so we don’t omit rows based on missing values in unused variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> bonobos <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(fWHR, weight, AssR, Sex, Group) <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">preds =</span> <span class="fu">predict</span>(mlr3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>We have a full set of predictions!</em></p>
<p>But if we plot these predictions on a scatter plot of <code>fWHR</code> as a function of <code>AssR</code>, we <em>do not</em> get a straight line, because the predictions are also impacted by varying values of <code>weight</code>, <code>Sex</code>, and <code>Group</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_point</span>(fWHR <span class="sc">~</span> AssR, <span class="at">data =</span> b2) <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_line</span>(preds <span class="sc">~</span> AssR, <span class="at">data=</span>b2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lm1_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p><em>But…we would really like a straight line that helps us visualize the meaning of the</em> <span class="math inline">\(\beta\)</span> (slope coefficient) for <code>AssR</code>. We can make predictions for a <strong>hypothetical</strong> dataset, in which <code>AssR</code> varies over a reasonable range, but the other predictors stay constant. This lets us see how <code>AssR</code> (and only <code>AssR</code>) affects the response, without contributions from other predictors. In choosing the values to include in hypothetical dataset, we often choose to hold variables constant at their most common or median values, but not blindly: also, avoid impossible or implausible variable combinations (for example, specifying that a person lives in the state of Michigan but the city of Chicago, or that they are a 5-year-old person with 4 children). <em>In this case, to match the figures in the published paper, we are also going to vary the <code>Sex</code> - but generally you’d only allow one predictor to vary.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fake_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">AssR =</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="fl">1.8</span>, <span class="at">to=</span><span class="fl">5.7</span>, <span class="at">by=</span><span class="fl">0.05</span>),</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">weight =</span> <span class="fl">38.5</span>,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Sex =</span> <span class="fu">c</span>(<span class="st">'Female'</span>, <span class="st">'Male'</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Group =</span> <span class="st">'Wuppertal'</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>fake_data <span class="ot">&lt;-</span> fake_data <span class="sc">|&gt;</span> </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">preds =</span> <span class="fu">predict</span>(mlr3, <span class="at">newdata =</span> fake_data))</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_line</span>(preds <span class="sc">~</span> AssR, <span class="at">color =</span> <span class="sc">~</span>Sex, <span class="at">data=</span>fake_data) <span class="sc">|&gt;</span> <span class="fu">gf_labs</span>(<span class="at">y=</span><span class="st">'Predicted</span><span class="sc">\n</span><span class="st">fWHR'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lm1_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<section id="comprehension-checks" class="level4" data-number="1.8.2.1">
<h4 data-number="1.8.2.1" class="anchored" data-anchor-id="comprehension-checks"><span class="header-section-number">1.8.2.1</span> Comprehension checks:</h4>
<ul>
<li>Should we overlay prediction-plot line(s) on the data scatter plot?</li>
<li>How do you think the plot would look if we changed the constant predictor values?</li>
<li>What is missing from this picture?</li>
</ul>
</section>
<section id="shortcut" class="level4" data-number="1.8.2.2">
<h4 data-number="1.8.2.2" class="anchored" data-anchor-id="shortcut"><span class="header-section-number">1.8.2.2</span> Shortcut</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(s245)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pred_plot</span>(mlr3, <span class="st">'AssR'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lm1_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="624"></p>
</div>
</div>
</section>
</section>
</section>
<section id="why-are-we-doing-this-again" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="why-are-we-doing-this-again"><span class="header-section-number">1.9</span> Why are we doing this again?</h2>
<p>Why make prediction plots?</p>
</section>
<section id="shortcut-method---with-uncertainty" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="shortcut-method---with-uncertainty"><span class="header-section-number">1.10</span> Shortcut Method - With Uncertainty</h2>
<p>We saw before that <code>pred_plot()</code> makes it very easy for us to generate prediction plots showing what a (multiple regression) model says about the relationship between the response and <em>one</em> of the predictors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(s245)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pred_plot</span>(mlr3, <span class="st">'AssR'</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_labs</span>(<span class="at">y =</span> <span class="st">'Predicted fWHR'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lm1_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="624"></p>
</div>
</div>
<p><em>Note the custom axis label - otherwise you get a long, unwieldy default “Predictions from fitted model”</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(s245)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pred_plot</span>(mlr3, <span class="st">'Group'</span>) <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_labs</span>(<span class="at">y =</span> <span class="st">'Predicted fWHR'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lm1_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="624"></p>
</div>
</div>
<p>They look nice! But they should raise two questions:</p>
<ul>
<li><p>Uncertainty:</p></li>
<li><p>Fixed values:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_fixed</span>(bonobos)  <span class="sc">|&gt;</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  pander<span class="sc">::</span><span class="fu">pander</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p>Quitting from lines 548-550 [unnamed-chunk-18] (lm1.rmarkdown) Error in <code>if (class(data[, v]) == "character") ...</code>: ! the condition has length &gt; 1 Backtrace: 1. pander::pander(get_fixed(bonobos)) 2. s245::get_fixed(bonobos)</p>
</div>
</div>
<section id="anatomy-of-a-confidence-interval" class="level3" data-number="1.10.1">
<h3 data-number="1.10.1" class="anchored" data-anchor-id="anatomy-of-a-confidence-interval"><span class="header-section-number">1.10.1</span> Anatomy of a Confidence Interval</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pred_plot</span>(mlr3, <span class="st">'Sex'</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_labs</span>(<span class="at">y =</span> <span class="st">'Predicted fWHR'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lm1_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="288"></p>
</div>
</div>
</section>
</section>
<section id="diy-method" class="level2" data-number="1.11">
<h2 data-number="1.11" class="anchored" data-anchor-id="diy-method"><span class="header-section-number">1.11</span> DIY Method</h2>
<section id="creating-a-hypothetical-dataset" class="level3" data-number="1.11.1">
<h3 data-number="1.11.1" class="anchored" data-anchor-id="creating-a-hypothetical-dataset"><span class="header-section-number">1.11.1</span> Creating a hypothetical dataset</h3>
<p>We would like to create a hypothetical dataset where one predictor variable varies, and all the rest stay fixed. Let’s choose <code>AssR</code>. We use <code>expand.grid()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fake_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">AssR =</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="fl">1.8</span>, <span class="at">to=</span><span class="fl">5.7</span>, <span class="at">by=</span><span class="fl">0.05</span>),</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">weight =</span> <span class="dv">40</span>,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Sex =</span> <span class="st">'Female'</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Group =</span> <span class="st">'Twycross'</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(fake_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 79
Columns: 4
$ AssR   &lt;dbl&gt; 1.80, 1.85, 1.90, 1.95, 2.00, 2.05, 2.10, 2.15, 2.20, 2.25, 2.3…
$ weight &lt;dbl&gt; 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40,…
$ Sex    &lt;fct&gt; Female, Female, Female, Female, Female, Female, Female, Female,…
$ Group  &lt;fct&gt; Twycross, Twycross, Twycross, Twycross, Twycross, Twycross, Twy…</code></pre>
</div>
</div>
<p>Now, make predictions for our fake data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(mlr3, <span class="at">newdata =</span> fake_data, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>fake_data <span class="ot">&lt;-</span> fake_data <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fitted =</span> preds<span class="sc">$</span>fit,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">se.fit =</span> preds<span class="sc">$</span>se.fit)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(fake_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 79
Columns: 6
$ AssR   &lt;dbl&gt; 1.80, 1.85, 1.90, 1.95, 2.00, 2.05, 2.10, 2.15, 2.20, 2.25, 2.3…
$ weight &lt;dbl&gt; 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40,…
$ Sex    &lt;fct&gt; Female, Female, Female, Female, Female, Female, Female, Female,…
$ Group  &lt;fct&gt; Twycross, Twycross, Twycross, Twycross, Twycross, Twycross, Twy…
$ fitted &lt;dbl&gt; 1.149038, 1.152256, 1.155474, 1.158692, 1.161910, 1.165128, 1.1…
$ se.fit &lt;dbl&gt; 0.08347207, 0.08267088, 0.08187552, 0.08108616, 0.08030298, 0.0…</code></pre>
</div>
</div>
<p>How do we go from <em>standard errors</em> to <em>confidence intervals</em>? We can either do this before plotting, or while plotting. To do it before and add the results to the hypothetical dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>fake_data <span class="ot">&lt;-</span> fake_data <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CI_lower =</span> fitted <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>se.fit,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">CI_upper =</span> fitted <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>se.fit)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(fake_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 79
Columns: 8
$ AssR     &lt;dbl&gt; 1.80, 1.85, 1.90, 1.95, 2.00, 2.05, 2.10, 2.15, 2.20, 2.25, 2…
$ weight   &lt;dbl&gt; 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 4…
$ Sex      &lt;fct&gt; Female, Female, Female, Female, Female, Female, Female, Femal…
$ Group    &lt;fct&gt; Twycross, Twycross, Twycross, Twycross, Twycross, Twycross, T…
$ fitted   &lt;dbl&gt; 1.149038, 1.152256, 1.155474, 1.158692, 1.161910, 1.165128, 1…
$ se.fit   &lt;dbl&gt; 0.08347207, 0.08267088, 0.08187552, 0.08108616, 0.08030298, 0…
$ CI_lower &lt;dbl&gt; 0.9854326, 0.9902210, 0.9949980, 0.9997632, 1.0045164, 1.0092…
$ CI_upper &lt;dbl&gt; 1.312643, 1.314291, 1.315950, 1.317621, 1.319304, 1.321000, 1…</code></pre>
</div>
</div>
</section>
<section id="making-the-plot" class="level3" data-number="1.11.2">
<h3 data-number="1.11.2" class="anchored" data-anchor-id="making-the-plot"><span class="header-section-number">1.11.2</span> Making the plot</h3>
<p>Now, we just need to plot!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_line</span>(fitted <span class="sc">~</span> AssR, <span class="at">data=</span>fake_data) <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_labs</span>(<span class="at">y=</span><span class="st">'Predicted</span><span class="sc">\n</span><span class="st">fWHR'</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_ribbon</span>(CI_lower <span class="sc">+</span> CI_upper <span class="sc">~</span> AssR, <span class="at">data =</span> fake_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lm1_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="576"></p>
</div>
</div>
<p>If we wanted to figure out the CI bounds <em>while</em> plotting, we could calculate them on the fly like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_line</span>(fitted <span class="sc">~</span> AssR, <span class="at">data=</span>fake_data) <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_labs</span>(<span class="at">y=</span><span class="st">'Predicted</span><span class="sc">\n</span><span class="st">fWHR'</span>) <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_ribbon</span>((fitted <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>se.fit ) <span class="sc">+</span> (fitted <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>se.fit) <span class="sc">~</span> AssR,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> fake_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>(which will look just the same).</p>
</section>
<section id="categorical-predictors" class="level3" data-number="1.11.3">
<h3 data-number="1.11.3" class="anchored" data-anchor-id="categorical-predictors"><span class="header-section-number">1.11.3</span> Categorical predictors</h3>
<p>What will be different if the predictor of interest is <em>categorical</em>?</p>
<ul>
<li><p>hypothetical data:</p></li>
<li><p>plot:</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>fake_sex_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">AssR =</span> <span class="fl">4.51</span>,</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">weight =</span> <span class="dv">40</span>,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Sex =</span> <span class="fu">c</span>(<span class="st">'Male'</span>, <span class="st">'Female'</span>),</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">Group =</span> <span class="st">'Twycross'</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(mlr3, <span class="at">newdata =</span> fake_sex_data, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>fake_sex_data <span class="ot">&lt;-</span> fake_sex_data <span class="sc">|&gt;</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fitted =</span> preds<span class="sc">$</span>fit,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">se.fit =</span> preds<span class="sc">$</span>se.fit)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="fu">gf_point</span>(fitted <span class="sc">~</span> Sex, <span class="at">data=</span>fake_sex_data) <span class="sc">|&gt;</span> </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_labs</span>(<span class="at">y=</span><span class="st">'Predicted fWHR'</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gf_errorbar</span>((fitted <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>se.fit ) <span class="sc">+</span> (fitted <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>se.fit) <span class="sc">~</span> Sex, </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> fake_sex_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lm1_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="336"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preface</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./lm-assess.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Model Diagnostics and Assessment</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>