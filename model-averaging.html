<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>GLMs and Friends - 6&nbsp; Model Averaging</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./interactions.html" rel="next">
<link href="./count-data-regression.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./model-averaging.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Model Averaging</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">GLMs and Friends</a> 
        <div class="sidebar-tools-main">
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./GLMs-and-Friends.pdf">
              <i class="bi bi-bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./GLMs-and-Friends.epub">
              <i class="bi bi-bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lm1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Linear Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./IC-based-selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Model Selection Using Information Criteria</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./likelihood.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Likelihood</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pdf-pmf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">PDFs and PMFs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./count-data-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Regression for Count Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-averaging.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Model Averaging</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interactions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Interactions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./binary-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Binary Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./binary-regression2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Binary regression: Data with more than one trial per row</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./collinearity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Collinearity and Multicollinearity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./zero-inflation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Zero-Inflation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ncv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Non-constant variance (and other unresolved problems)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./random-effects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Random Effects</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./random-effects2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Random effects with glmmTMB and standardized residuals</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gee-motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">GEEs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./corr-struct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Correlation Structures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./anova-plus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Other Model Selection Approaches</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">GAMs: Generalized Additive Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-school-survey-on-crime-and-safety" id="toc-data-school-survey-on-crime-and-safety" class="nav-link active" data-scroll-target="#data-school-survey-on-crime-and-safety"><span class="header-section-number">6.1</span> Data: School Survey on Crime and Safety</a></li>
  <li><a href="#modelling-number-of-violent-incidents-per-school" id="toc-modelling-number-of-violent-incidents-per-school" class="nav-link" data-scroll-target="#modelling-number-of-violent-incidents-per-school"><span class="header-section-number">6.2</span> Modelling number of violent incidents per school</a></li>
  <li><a href="#model-averaging" id="toc-model-averaging" class="nav-link" data-scroll-target="#model-averaging"><span class="header-section-number">6.3</span> Model Averaging</a>
  <ul class="collapse">
  <li><a href="#getting-the-averaged-model" id="toc-getting-the-averaged-model" class="nav-link" data-scroll-target="#getting-the-averaged-model"><span class="header-section-number">6.3.1</span> Getting the Averaged Model</a></li>
  <li><a href="#getting-predictions-from-the-averaged-model" id="toc-getting-predictions-from-the-averaged-model" class="nav-link" data-scroll-target="#getting-predictions-from-the-averaged-model"><span class="header-section-number">6.3.2</span> Getting Predictions from the Averaged Model</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Model Averaging</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>So far, we have used AIC and/or BIC for model selection, to decide which variables to keep in a “best” model and which to exclude. But we have already seen a number of cases where there is not <strong>one</strong> model that is clearly superior to all the others. In those cases, we have decided on the smallest model (with the fewest predictors), but there are other options when many competing models have similar scores.</p>
<p>One option is <em>not to choose</em> – instead, keep them all, and make predictions via a weighted average of all the models. The models with the best IC scores get more weight. This can be a good option if the main goal is accurate prediction (rather than deciding definitively which predictors are “good” ones and which are not).</p>
<p>How can we do it? Let’s explore an example.</p>
<section id="data-school-survey-on-crime-and-safety" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="data-school-survey-on-crime-and-safety"><span class="header-section-number">6.1</span> Data: School Survey on Crime and Safety</h2>
<p>The data for this example are from a survey of U.S. schools, the 2000 School Survey on Crime and Safety. There is information about the study at</p>
<p><a href="http://catalog.data.gov/dataset/2000-school-survey-on-crime-and-safety" class="uri">http://catalog.data.gov/dataset/2000-school-survey-on-crime-and-safety</a>,</p>
<p>which says the study “is a cross-sectional survey of the nation’s public schools designed to provide estimates of school crime, discipline, disorder, programs and policies. SSOCS is administered to public primary, middle, high, and combined school principals in the spring of even-numbered school years…Public schools were sampled in the spring of 2000 to participate in the study.”</p>
<p>The dataset you will use is available online at:</p>
<p><a href="http://sldr.netlfiy.com/data/sscrime.csv">http://sldr.netlify.com/data/sscrime.csv</a></p>
<p>It contains a number of variables:</p>
<ul>
<li><code>VisitorCheckIn</code>: Whether visitors to the school must check in to gain entry to the school.</li>
<li><code>LockedGates</code>: Whether there are locked gates at the entry to the school.</li>
<li><code>MetalDetectors</code>: Whether there is a metal detector at the entrance to the school.</li>
<li><code>DrugSniffDog</code>: Whether a drug-sniffing dog is randomly brought into the school to carry out inspections.</li>
<li><code>DrugTesting</code>: Whether any drug testing of students occurs.</li>
<li><code>UniformsRequired</code>:Whether students are required to wear uniforms.</li>
<li><code>DressCode</code>: Whether a strict dress code is enforced.</li>
<li><code>Lockers</code>: Whether students have lockers.</li>
<li><code>StudentIDBadges</code>: Whether students are required to wear ID badges.</li>
<li><code>StaffIDBadges</code>: Whether teachers and other staff are required to wear ID badges.</li>
<li><code>SecurityCameras</code>: Whether there are security cameras on the premises.</li>
<li><code>OfficialRiotPlan</code>: Whether the school has a written plan in place for how to deal with a riot or large-scale fight.</li>
<li><code>ViolenceReductionProgram</code>: Whether the school has a Violence Reduction Program in place.</li>
<li><code>Security</code>: Whether security officers are present on the premises.</li>
<li><code>TrainingHours</code>: Average amount of time (in hours) that teachers and staff have devoted to training related to violence reduction.</li>
<li><code>AttacksWithoutWeapon</code>: Number of attacks that have occurred at the school, not involving a weapon.</li>
<li><code>Thefts</code>: Number of thefts.</li>
<li><code>Vandalism</code>: Number of incidents of vandalism.</li>
<li><code>ViolentIncidentsTotal</code>: Number of violent incidents of all types that have occurred at the school.</li>
<li><code>Enrollment</code>: Number of students enrolled in the school (categorical)</li>
<li><code>NEnrollment</code>: Number of students enrolled in the school (numeric)</li>
<li><code>SurveyRespondent</code>: The identity of the person who filled out the survey.</li>
<li><code>Location</code>: Whether the location of the school is Urban, Rural, etc.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>ssc <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'http://sldr.netlify.com/data/sscrime.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="modelling-number-of-violent-incidents-per-school" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="modelling-number-of-violent-incidents-per-school"><span class="header-section-number">6.2</span> Modelling number of violent incidents per school</h2>
<p>We will fit a model for the number of violent incidents total as a function of a number of predictors. This is count data and we will fit a negative binomial regression model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>school.nb2 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(ViolentIncidentsTotal <span class="sc">~</span> TrainingHours <span class="sc">+</span> Location <span class="sc">+</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                        SecurityCameras <span class="sc">+</span> DressCode <span class="sc">+</span> UniformsRequired <span class="sc">+</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                        NEnrollment, <span class="at">data=</span>ssc,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">family=</span><span class="fu">nbinom2</span>(<span class="at">link=</span><span class="st">'log'</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">na.action =</span> <span class="st">'na.fail'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I will use AIC and the <code>dredge()</code> function to compare all possible subsets of my saturated model and figure out which variables should be included in the best model. I chose AIC in this case because it is perhaps more widely used than BIC (that’s not a good reason unless you really have no better one, but there you have it) and because with the relatively small sample size here, I don’t feel a particular need to use BIC for its larger penalty term.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MuMIn)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#do "dredge" for model selection</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>mod.sel <span class="ot">&lt;-</span> <span class="fu">dredge</span>(school.nb2, <span class="at">rank=</span><span class="st">'AIC'</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mod.sel, <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Global model call: glmmTMB(formula = ViolentIncidentsTotal ~ TrainingHours + Location + 
    SecurityCameras + DressCode + UniformsRequired + NEnrollment, 
    data = ssc, family = nbinom2(link = "log"), na.action = "na.fail", 
    ziformula = ~0, dispformula = ~1)
---
Model selection table 
   cnd((Int)) dsp((Int)) cnd(DrC) cnd(Lct)  cnd(NEn) cnd(ScC)  cnd(TrH)
4       3.610          +        +        +                             
36      3.585          +        +        +                             
12      3.635          +        +        +                  +          
8       3.570          +        +        + 2.537e-05                   
20      3.608          +        +        +                    0.0008916
44      3.610          +        +        +                  +          
40      3.529          +        +        + 3.410e-05                   
16      3.588          +        +        + 3.140e-05        +          
   cnd(UnR) df    logLik    AIC delta weight
4            6 -1745.380 3502.8  0.00  0.287
36        +  7 -1745.017 3504.0  1.27  0.152
12           7 -1745.103 3504.2  1.45  0.139
8            7 -1745.280 3504.6  1.80  0.117
20           7 -1745.380 3504.8  2.00  0.106
44        +  8 -1744.734 3505.5  2.71  0.074
40        +  8 -1744.840 3505.7  2.92  0.067
16           8 -1744.953 3505.9  3.15  0.060
Models ranked by AIC(x) </code></pre>
</div>
</div>
<p>Because the first 7 or so models all have AIC scores within 3 units of each other, it is hard to choose one best model here. In this situation, one way to choose is to pick the model that includes the smallest number of predictors, and still acheives an AIC that is among the best. Another option would be to use <strong>model averaging</strong>.</p>
</section>
<section id="model-averaging" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="model-averaging"><span class="header-section-number">6.3</span> Model Averaging</h2>
<p>What if we wanted to use model averaging to find the best model, instead? We might choose this route because there are several models that all have AIC that are close to each other and thus fit the data approximately equally well. So we might choose to make predictions (and compute coefficients) that are the <em>average</em> of all the models (weighted by IC weights).</p>
<p>Notes of caution:</p>
<ul>
<li>If the model is not a linear regression (if there is a link function for instance) then it’s important to get <strong>predictions</strong> by <em>averaging the predictions from the different models</em>, <strong>not</strong> by making predictions using the model-averaged coefficients. The code below is careful to do this.</li>
<li>Model averaging is used pretty widely but is also controversial (like most model selection methods, in fact!) For example, see: [https://esajournals.onlinelibrary.wiley.com/doi/full/10.1890/14-1639.1] and [https://drewtyre.rbind.io/post/rebutting_cade/].</li>
</ul>
<p>To do model averaging, we use package <code>MuMIn</code> (function <code>model.avg</code>).</p>
<section id="getting-the-averaged-model" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="getting-the-averaged-model"><span class="header-section-number">6.3.1</span> Getting the Averaged Model</h3>
<p>The following code gets the average model. If we did the default (<code>fit=FALSE</code>), it would be a bit faster, but we would then not be able to get predictions from the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mod.sel2 <span class="ot">&lt;-</span> <span class="fu">dredge</span>(school.nb2)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ave.model <span class="ot">&lt;-</span> MuMIn<span class="sc">::</span><span class="fu">model.avg</span>(mod.sel2, <span class="at">fit=</span><span class="cn">TRUE</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ave.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
model.avg(object = get.models(object = mod.sel2, subset = NA))

Component model call: 
glmmTMB(formula = ViolentIncidentsTotal ~ &lt;64 unique rhs&gt;, data = ssc, 
     family = nbinom2(link = "log"), ziformula = ~0, dispformula = ~1, 
     na.action = na.fail)

Component models: 
       df   logLik    AICc delta weight
12      6 -1745.38 3502.98  0.00   0.24
126     7 -1745.02 3504.33  1.35   0.12
124     7 -1745.10 3504.51  1.52   0.11
123     7 -1745.28 3504.86  1.88   0.09
125     7 -1745.38 3505.06  2.08   0.08
1246    8 -1744.73 3505.86  2.87   0.06
1236    8 -1744.84 3506.07  3.08   0.05
1234    8 -1744.95 3506.29  3.31   0.05
1256    8 -1745.02 3506.42  3.44   0.04
1245    8 -1745.10 3506.59  3.60   0.04
1235    8 -1745.28 3506.95  3.96   0.03
12346   9 -1744.49 3507.46  4.48   0.03
12456   9 -1744.73 3507.95  4.96   0.02
12356   9 -1744.84 3508.17  5.18   0.02
12345   9 -1744.95 3508.38  5.40   0.02
123456 10 -1744.48 3509.56  6.58   0.01
2       5 -1753.09 3516.33 13.35   0.00
26      6 -1752.29 3516.80 13.82   0.00
24      6 -1752.60 3517.42 14.44   0.00
246     7 -1751.79 3517.87 14.89   0.00
25      6 -1753.09 3518.40 15.41   0.00
23      6 -1753.09 3518.40 15.41   0.00
236     7 -1752.26 3518.82 15.84   0.00
256     7 -1752.29 3518.87 15.89   0.00
234     7 -1752.59 3519.48 16.49   0.00
245     7 -1752.59 3519.49 16.50   0.00
2346    8 -1751.72 3519.82 16.83   0.00
2456    8 -1751.78 3519.96 16.97   0.00
235     7 -1753.09 3520.47 17.49   0.00
2356    8 -1752.26 3520.90 17.92   0.00
2345    8 -1752.59 3521.56 18.57   0.00
23456   9 -1751.71 3521.91 18.92   0.00
136     5 -1756.63 3523.42 20.43   0.00
1346    6 -1756.08 3524.39 21.41   0.00
13      4 -1758.25 3524.60 21.62   0.00
16      4 -1758.59 3525.28 22.29   0.00
1356    6 -1756.61 3525.44 22.45   0.00
134     5 -1757.74 3525.65 22.66   0.00
1       3 -1759.81 3525.68 22.69   0.00
13456   7 -1756.08 3526.46 23.48   0.00
135     5 -1758.21 3526.59 23.60   0.00
146     5 -1758.30 3526.76 23.78   0.00
14      4 -1759.53 3527.16 24.17   0.00
156     5 -1758.54 3527.24 24.26   0.00
15      4 -1759.75 3527.61 24.62   0.00
1345    6 -1757.73 3527.69 24.71   0.00
1456    6 -1758.28 3528.79 25.80   0.00
145     5 -1759.50 3529.15 26.17   0.00
36      4 -1765.82 3539.76 36.77   0.00
346     5 -1764.96 3540.08 37.10   0.00
6       3 -1767.12 3540.31 37.33   0.00
46      4 -1766.54 3541.19 38.20   0.00
356     5 -1765.77 3541.70 38.71   0.00
3456    6 -1764.95 3542.12 39.14   0.00
56      4 -1767.04 3542.18 39.20   0.00
(Null)  2 -1769.34 3542.72 39.74   0.00
3       3 -1768.50 3543.05 40.07   0.00
456     5 -1766.50 3543.17 40.18   0.00
34      4 -1767.71 3543.52 40.54   0.00
4       3 -1768.77 3543.61 40.63   0.00
5       3 -1769.24 3544.54 41.55   0.00
35      4 -1768.41 3544.93 41.95   0.00
345     5 -1767.68 3545.51 42.53   0.00
45      4 -1768.72 3545.54 42.55   0.00

Term codes: 
       cond(DressCode)         cond(Location)      cond(NEnrollment) 
                     1                      2                      3 
 cond(SecurityCameras)    cond(TrainingHours) cond(UniformsRequired) 
                     4                      5                      6 

Model-averaged coefficients:  
(full average) 
                             Estimate Std. Error Adjusted SE z value Pr(&gt;|z|)
cond((Int))                 3.596e+00  1.316e-01   1.320e-01  27.252  &lt; 2e-16
cond(DressCodeyes)          3.765e-01  9.608e-02   9.639e-02   3.906 9.39e-05
cond(LocationRural)        -5.597e-01  1.328e-01   1.332e-01   4.201 2.65e-05
cond(LocationTown)         -5.874e-01  1.543e-01   1.548e-01   3.795 0.000148
cond(LocationUrban Fringe) -1.024e-01  1.179e-01   1.183e-01   0.866 0.386523
cond(UniformsRequiredyes)   5.685e-02  1.373e-01   1.376e-01   0.413 0.679432
cond(SecurityCamerasyes)   -2.384e-02  6.451e-02   6.466e-02   0.369 0.712383
cond(NEnrollment)           8.826e-06  2.812e-05   2.818e-05   0.313 0.754163
cond(TrainingHours)        -2.156e-04  2.509e-02   2.517e-02   0.009 0.993166
                              
cond((Int))                ***
cond(DressCodeyes)         ***
cond(LocationRural)        ***
cond(LocationTown)         ***
cond(LocationUrban Fringe)    
cond(UniformsRequiredyes)     
cond(SecurityCamerasyes)      
cond(NEnrollment)             
cond(TrainingHours)           
 
(conditional average) 
                             Estimate Std. Error Adjusted SE z value Pr(&gt;|z|)
cond((Int))                 3.596e+00  1.316e-01   1.320e-01  27.252  &lt; 2e-16
cond(DressCodeyes)          3.771e-01  9.499e-02   9.530e-02   3.956 7.61e-05
cond(LocationRural)        -5.598e-01  1.328e-01   1.332e-01   4.203 2.63e-05
cond(LocationTown)         -5.874e-01  1.542e-01   1.547e-01   3.796 0.000147
cond(LocationUrban Fringe) -1.024e-01  1.179e-01   1.183e-01   0.866 0.386505
cond(UniformsRequiredyes)   1.661e-01  1.921e-01   1.927e-01   0.862 0.388948
cond(SecurityCamerasyes)   -7.409e-02  9.597e-02   9.628e-02   0.770 0.441588
cond(NEnrollment)           3.049e-05  4.550e-05   4.565e-05   0.668 0.504120
cond(TrainingHours)        -8.265e-04  4.912e-02   4.928e-02   0.017 0.986617
                              
cond((Int))                ***
cond(DressCodeyes)         ***
cond(LocationRural)        ***
cond(LocationTown)         ***
cond(LocationUrban Fringe)    
cond(UniformsRequiredyes)     
cond(SecurityCamerasyes)      
cond(NEnrollment)             
cond(TrainingHours)           
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p><strong>If you are trying to get model-averaged coefficients from the summary output above, be sure to look for the “full average” ones and not the “conditional average” (which only includes models where the predictor was included, i.e., where the coefficient was not 0).</strong></p>
</section>
<section id="getting-predictions-from-the-averaged-model" class="level3" data-number="6.3.2">
<h3 data-number="6.3.2" class="anchored" data-anchor-id="getting-predictions-from-the-averaged-model"><span class="header-section-number">6.3.2</span> Getting Predictions from the Averaged Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ma.preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(ave.model, <span class="at">se.fit=</span><span class="cn">TRUE</span>,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">'response'</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">backtransform =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting predictions are a list with entries <code>fit</code> and <code>se.fit</code> just like we are used to. (So you could make predictions with a <code>newdata</code> data set and use them for prediction plots, for example. Be careful – your “new” dataset now has to include values for all candidate predictors in the full model.)</p>
<p>Comparing with the predictions from our previous “best” model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>best.school.nb2 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(ViolentIncidentsTotal <span class="sc">~</span> DressCode <span class="sc">+</span> Location,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data=</span>ssc,<span class="at">family=</span><span class="fu">nbinom2</span>(<span class="at">link=</span><span class="st">'log'</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pred_plot(ave.model, 'DressCode', ylab = 'N. Incidents',</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#             data = ssc, color = 'red')</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># pred_plot(best.school.nb2, 'DressCode', ylab = 'N. Incidents',) </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So they are pretty comparable, but a little different (the differences may be bigger the more there are different models with similar IC results contributing to the average model – when one model carries almost all the weight, then the “single best” model and the model-averaging model will give almost the same results). It also makes sense that there will be a bit more uncertainty in the average model.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./count-data-regression.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Regression for Count Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./interactions.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Interactions</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>